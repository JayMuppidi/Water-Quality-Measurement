<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="refresh" content="120">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Water Quality Dashboard</title>
  
  <!--Styling/CSS stuff-->
  
  <link rel="stylesheet" href = "styling.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;800&display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;1,300&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">

  <!--Done-->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script>
    function fetch_values () {
      $('#error').text("Data is being fetched.");
      $.ajax({
        type: "GET",
        url: 'https://api.thingspeak.com/channels/1904915/feeds.json?api_key=ZDPYT298KYQGB8QD&results=1',
        data: {
          format: 'json'
        },
        success: function (data) {
          $('#error').text("Data has been fetched.");
          $('#field1').text(data.feeds[0].field1);
          $('#field2').text(data.feeds[0].field2);
          $('#field3').text(data.feeds[0].field3);
          $('#field4').text(data.feeds[0].field4);
          check_values();

        },
        error: function () {
          $('#error').text("There was an error in fetching values.");
        },
        complete: function () {
          setTimeout(fetch_values, 15000);
        }
      });
    }

    function check_values() {
      var field1 = parseFloat($('#field1').text());
      var field2 = parseFloat($('#field2').text());
      var field3 = parseFloat($('#field3').text());
      var field4 = parseFloat($('#field4').text());

      if (field1 > 500) {
        $('#field1').css('color', 'red');
      }
      if (field2 > 25) {
        $('#field2').css('color', 'red');
      }
      if (field3 > 5) {
        $('#field3').css('color', 'red');
      }
      if (field4 < 6.5 || field4 > 8.5) {
        $('#field4').css('color', 'red');
      }
    }

    $(document).ready(function () {
      fetch_values();
    });

  </script>
</head>

<body>
  <h1 class = "Title">Water Quality</h1>

  <div class="result">
    <p class="resultChild">TDS: <span id="field1"></span></p>
    <p class="resultChild">Temperature: <span id="field2"></span></p>
    <p class="resultChild">Turbidity: <span id="field3"></span></p>
    <p class="resultChild">pH: <span id="field4"></span></p>
  </div>
  <p id="error"></p>
  <div>
    <table id="GraphTable">
      <tr>
        <td colspan="2">
          <h1 class = "Title" >Data</h1>
        </td>
      </tr>
      <tr>
        <td><iframe width="450" height="260" style="border: 1px solid #cccccc;"
            src="https://thingspeak.com/channels/1904915/charts/1?dynamic=true&api_key=ZDPYT298KYQGB8QD&bgcolor=%23000000&color=%23d62020&dynamic=true&results=60&title=TDS&type=line"></iframe>
        </td>
        <td><iframe width="450" height="260" style="border: 1px solid #cccccc;"
            src="https://thingspeak.com/channels/1904915/charts/2?dynamic=true&api_key=ZDPYT298KYQGB8QD&bgcolor=%23000000&color=%23d62020&dynamic=true&results=60&title=Temperature&type=line"></iframe>
        </td>
      </tr>
      <tr>
        <td><iframe width="450" height="260" style="border: 1px solid #cccccc;"
            src="https://thingspeak.com/channels/1904915/charts/3?dynamic=true&api_key=ZDPYT298KYQGB8QD&bgcolor=%23000000&color=%23d62020&dynamic=true&results=60&title=Turbidity&type=line"></iframe>
        </td>
        <td><iframe width="450" height="260" style="border: 1px solid #cccccc;"
            src="https://thingspeak.com/channels/1904915/charts/4?dynamic=true&api_key=ZDPYT298KYQGB8QD&bgcolor=%23000000&color=%23d62020&dynamic=true&results=60&title=pH&type=line"></iframe>
        </td>
    </table>
  </div>

</body>

</html>